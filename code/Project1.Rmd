---
title: "United Airlines Departure Delays"
authors: Dan Nguyen, Jennifer Poling, Paul Skentzos
output: html_document
date: "2025-10-25"
---
# United Airlines Departure Delays Prject

This project will examine the relationship between United Airlines departure delays and time of day, time of year, temperature, wind speed, precipitation, and visibility.

###### Install libraries
```{r}
library(tidyverse)
library(nycflights13)
```
## Prepare the Data

###### Inspect the data
```{r}
glimpse(flights)
```
```{r}
glimpse(weather)
```

###### Keep only the relevant United Airlines flights 

```{r}
flights_UA <- flights %>%
  filter(carrier == 'UA') %>%
  filter(!is.na(dep_delay)) 
```


###### Create the "late" and "very_late" columns
```{r}
flights_UA <- flights_UA %>%
  mutate(
    late = dep_delay > 0,
    very_late = dep_delay > 30
    )
glimpse(flights_UA)
```

###### Join the flight data and the weather data.

Use a left join so that the weather data is applied to each flight

```{r}
flights_weather <- flights_UA %>%
  left_join(weather, by = c('origin', 'time_hour', 'year', 'month', 'day', 'hour'))
glimpse(flights_weather)
```

###### Create a "season" column.
First check how many are null values in the "month" column.
```{r}
sum(is.na(flights_weather$month))
```
Now create the "season" column. Use this definition: summer consists of June, July, and August; fall consists of September, October, and November; winter consists of December, January, and February; spring consists of March, April, and May.
```{r}
flights_weather <- flights_weather %>%
  mutate(season = case_when(
    month %in% c(12, 1, 2) ~ 'winter',
    month %in% c(3, 4, 5) ~ 'spring',
    month %in% c(6, 7, 8) ~ 'summer',
    month %in% c(9, 10, 11) ~ 'winter'
  ))
glimpse(flights_weather)
```

###### Create a time_of_day column.
What times do flights operate?
```{r}
unique(flights_weather$hour)
```
How many null values are there in the hour column?
```{r}
sum(is.na(flights_weather$hour))
```
Create a time_of_day column using the following definition. early: 5, 6, 7; morning: 8, 9, 10; mid_day: 11, 12, 13; afternoon: 14, 15, 16; evening: 17, 18, 19; late: 20, 21, 22, 23
```{r}
flights_weather <- flights_weather %>%
  mutate(time_of_day = case_when(
    hour %in% c(5, 6, 7) ~ 'early',
    hour %in% c(8, 9, 10) ~ 'morning',
    hour %in% c(11, 12, 13) ~ 'mid_day',
    hour %in% c(14, 15, 16) ~ 'afternoon',
    hour %in% c(17, 18, 19) ~ 'evening',
    hour %in% c(20, 21, 22, 23) ~ 'night' 
  ))
glimpse(flights_weather)    
```
######## Convert the time_of_day column to a factor with a specific order for consistent plotting and analysis
```{r}
flights_weather <- flights_weather %>%
  mutate(time_of_day = fct_relevel(time_of_day,
                                 'early',
                                 'morning',
                                 'mid_day',
                                 'afternoon',
                                 'evening',
                                 'night'))
count(flights_weather, time_of_day)
```

###### Create Visibility Categories
What is in the visibility column?
```{r}
unique(flights_weather$visib)
```
How many NA values are there in the visibility column?
```{r}
sum(is.na(flights_weather$visib))
```
Keep the rows that have visibility values
```{r}
flights_weather <- flights_weather %>%
  filter(!is.na(visib))
```


Create visibility categories based on common visibility cutoffs in aviation. IMC (Instrument Meteorological Conditions): below 3, call this 'poor'. MVFR (Marginal Visual Flight Rules): 3 to 5, call this 'fair'. VFR (Visual Flight Rules): above 5, call this 'good'.
```{r}
flights_weather <- flights_weather %>%
  mutate(visib_cat = case_when(
    visib < 3 ~ 'poor',
    visib >=3 & visib <= 5 ~ 'fair',
    visib > 5 ~ 'good'
  ))
glimpse(flights_weather)
```

######## Convert the visibility category column to a factor with a specific order for consistent plotting and analysis
```{r}
flights_weather <- flights_weather %>%
  mutate(visib_cat = fct_relevel(visib_cat,
                                 'poor',
                                 'fair',
                                 'good'))
count(flights_weather, visib_cat)
```
###### Create a column for whether or not there is precipitation.
```{r}
flights_weather <- flights_weather %>%
  mutate(precip_binary = precip > 0.00)
count(flights_weather, precip_binary)
```
###### Create quantile bins for temperature.
```{r}
sum(is.na(flights_weather$temp))
```
Remove rows with NA in the temperature column.
```{r}
flights_weather <- flights_weather %>%
  filter(!is.na(temp))
```
Calculate the quantiles
```{r}
temp_quantiles <- quantile(flights_weather$temp, probs = seq(0, 1, 0.25))
```
Create a new column
```{r}
flights_weather$temp_q <- cut(flights_weather$temp,
                              breaks = temp_quantiles,
                              include.lowest = TRUE,
                              right = FALSE)

# Check the distribution of the new bins
table(flights_weather$temp_q)
```
###### Create quantile bins for wind speed.
```{r}
sum(is.na(flights_weather$wind_speed))
```
Remove rows with NA in the wind speed column.
```{r}
flights_weather <- flights_weather %>%
  filter(!is.na(wind_speed))
```
Calculate the quantiles
```{r}
wind_speed_quantiles <- quantile(flights_weather$wind_speed, probs = seq(0, 1, 0.25))
```
Create a new column
```{r}
flights_weather$wind_speed_q <- cut(flights_weather$wind_speed,
                              breaks = wind_speed_quantiles,
                              include.lowest = TRUE,
                              right = FALSE)

# Check the distribution of the new bins
table(flights_weather$wind_speed_q)
```
###### Create a column for whether or not there are wind gusts.
I think that NA means there weren't wind gusts. Check how many NA values in the wind gust column.
```{r}
sum(is.na(flights_weather$wind_gust))
```
Create a wind gust binary column.
```{r}
flights_weather <- flights_weather %>%
  mutate(wind_gust_binary = !is.na(wind_gust))
count(flights_weather, wind_gust_binary)
```
Create a summary table.
```{r}
summary(flights_weather)
```
Output the clean .csv
```{r}
write_csv(flights_weather, 'flights_clean.csv')
```



